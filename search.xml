<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>《Python3 面向对象编程》笔记 - 第3章 对象相似时</title>
      <link href="/2020/06/29/python-object-3/"/>
      <url>/2020/06/29/python-object-3/</url>
      
        <content type="html"><![CDATA[<h1 id="Python3-面向对象编程笔记"><a href="#Python3-面向对象编程笔记" class="headerlink" title="Python3 面向对象编程笔记"></a>Python3 面向对象编程笔记</h1><h2 id="第3章-对象相似时"><a href="#第3章-对象相似时" class="headerlink" title="第3章 对象相似时"></a>第3章 对象相似时</h2><p>在编程的世界中，重复的代码被认为是邪恶的。这一章主要学习继承。既将共有的逻辑抽象到超类并在子类中控制具体的细节。这一章主要学习：</p><ol><li>基本的基础</li><li>从内置类型基础</li><li>多重基础</li><li>多态与鸭子类型</li></ol><h3 id="基本的基础"><a href="#基本的基础" class="headerlink" title="基本的基础"></a>基本的基础</h3><p>严格来说，在Python中，我们都是用到了基础。所有的Python类都可以看做是继承了<code>object</code>类的子类</p><p>我们声明一个类时可以显示的声明基础的类是什么，如果隐藏了父类，那么默认就是继承的<code>object</code>类</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyTest</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">class</span> <span class="token class-name">MyTest2</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这两种其实都是一样的。</p><p>在实践中使用继承关系，最简单的就是为已经存在的类添加功能，先写一个实例</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 类变量</span>    all_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span>test1 <span class="token operator">=</span> Contact<span class="token punctuation">(</span><span class="token string">"name1"</span><span class="token punctuation">,</span> <span class="token string">"name@qq.com"</span><span class="token punctuation">)</span>test2 <span class="token operator">=</span> Contact<span class="token punctuation">(</span><span class="token string">"name2"</span><span class="token punctuation">,</span> <span class="token string">"name2@qq.com"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>test2<span class="token punctuation">.</span>all_contacts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># [ &lt; __main__.Contact object at 0x103b3afd0 > , &lt; __main__.Contact object at 0x103b42048 > ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在上面的代码中有个概念<strong>类变量</strong>，代码中的<code>all_contacts</code>就是类变量，他可以被该类的所有实例共享。在子类中可以通过<code>self.all_contacts</code>获取该类变量，如果在这一对象中找不到该变量名，将会从类中找到。如果你用了<code>self.all_contacts</code>设定了这一变量。实际上只是设定了该对象的这以变量，并不会影响类变量，还是可以通过<code>Contacts.all_contacts</code>访问到</p><p>上面的例子是一个联系人的类，其中有名字和邮箱。我们需要从这些联系人中下订单，需要新加一个类</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 类变量</span>    all_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Supplier</span><span class="token punctuation">(</span>Contact<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 这里会自动调用父类的__init__方法</span>    <span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>            f<span class="token string">"If this were a real system we would send {order} to {self.name}"</span><span class="token punctuation">)</span>c <span class="token operator">=</span> Contact<span class="token punctuation">(</span><span class="token string">"Some Body"</span><span class="token punctuation">,</span> <span class="token string">"somebody@example.net"</span><span class="token punctuation">)</span>s <span class="token operator">=</span> Supplier<span class="token punctuation">(</span><span class="token string">"sup Plier"</span><span class="token punctuation">,</span> <span class="token string">"supplier@example.net"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>all_contacts<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># [&lt;__main__.Contact object at 0x1073f9f60>, &lt;__main__.Supplier object at 0x1073f9fd0>]</span><span class="token comment" spellcheck="true"># c.order("I need pliers") 会报错</span>s<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string">"I need pliers"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># If this were a real system we would send I need pliers to sup Plier</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里<code>Supplier</code>能够做<code>Contact</code>能做的所有事（加入<code>all_contacts</code>），而且还有自己的方法。</p><h3 id="扩展内置对象"><a href="#扩展内置对象" class="headerlink" title="扩展内置对象"></a>扩展内置对象</h3><p>继承关系中有一种有趣的应用就是为内置类型添加新的功能，比如前面的例子中保存了联系人，如果想查找联系人就可以添加一个新的类</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ContactList</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>        matching_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> contact <span class="token keyword">in</span> self<span class="token punctuation">:</span>            <span class="token keyword">if</span> name <span class="token keyword">in</span> contact<span class="token punctuation">.</span>name<span class="token punctuation">:</span>                matching_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>contact<span class="token punctuation">)</span>        <span class="token keyword">return</span> matching_contacts<span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 类变量</span>    all_contacts <span class="token operator">=</span> ContactList<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Supplier</span><span class="token punctuation">(</span>Contact<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 这里会自动调用父类的__init__方法</span>    <span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>            f<span class="token string">"If this were a real system we would send {order} to {self.name}"</span><span class="token punctuation">)</span>c <span class="token operator">=</span> Contact<span class="token punctuation">(</span><span class="token string">"Some Body"</span><span class="token punctuation">,</span> <span class="token string">"somebody@example.net"</span><span class="token punctuation">)</span>s <span class="token operator">=</span> Supplier<span class="token punctuation">(</span><span class="token string">"sup Plier"</span><span class="token punctuation">,</span> <span class="token string">"supplier@example.net"</span><span class="token punctuation">)</span>s2 <span class="token operator">=</span> Supplier<span class="token punctuation">(</span><span class="token string">"sup Body"</span><span class="token punctuation">,</span> <span class="token string">"supplier2@example.net"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>contact<span class="token punctuation">.</span>name <span class="token keyword">for</span> contact <span class="token keyword">in</span> Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"Body"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># ['Some Body', 'sup Body']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>大多数的内置对象都可以通过这种方式进行扩展。通常会扩展的内置类型有：<code>object</code>、<code>list</code>、<code>set</code>、<code>dict</code>、<code>file</code>、<code>str</code></p><p>比如扩展<code>dict</code>类型</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TestDict</span><span class="token punctuation">(</span>dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">longest_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        longest <span class="token operator">=</span> None        <span class="token keyword">for</span> key <span class="token keyword">in</span> self<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token operator">not</span> longest <span class="token operator">or</span> len<span class="token punctuation">(</span>longest<span class="token punctuation">)</span> <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>                longest <span class="token operator">=</span> key        <span class="token keyword">return</span> longestlongest_keys <span class="token operator">=</span> TestDict<span class="token punctuation">(</span><span class="token punctuation">)</span>longest_keys<span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>longest_keys<span class="token punctuation">[</span><span class="token string">"hello world"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>longest_keys<span class="token punctuation">[</span><span class="token string">"xx"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>longest_keys<span class="token punctuation">.</span>longest_key<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># hello world</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="重写和super"><a href="#重写和super" class="headerlink" title="重写和super"></a>重写和super</h3><p>继承关系很适合向已经存在的类中添加新的行为，如果需要修改某些行为，就要重写父类的某些方法。当一个子类重写了父类的一个方法，在调用该方法时会调用子类的方法。而不是父类的方法</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 类变量</span>    all_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Friend</span><span class="token punctuation">(</span>Contact<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        self<span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在上面的例子中，我们重写了<code>__init__</code>方法。但是会有重复的代码，而且我们还必须手动加入<code>Contact.all_contacts</code>中。</p><blockquote><p>任何方法都可以被重写</p></blockquote><p>我们真正需要做的是执行Contact类上的<code>__init__</code>方法。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 类变量</span>    all_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Friend</span><span class="token punctuation">(</span>Contact<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">,</span> email<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们调用了<code>super()</code>函数获取父类对象的实例，然后调用他的<code>__init__</code>方法</p><blockquote><p>可以在任何方法内调用<code>super()</code>获取父类对象实例</p></blockquote><h3 id="多重继承"><a href="#多重继承" class="headerlink" title="多重继承"></a>多重继承</h3><p>多重继承：继承自多个父类的子类可以获取所有父类的功能。</p><p>多重继承最简单的形式被称为混入（mixin），关于混入可以参考<a href="http://30daydo.com/article/480。其中利用混入实现多重继承比较重要的就是：" target="_blank" rel="noopener">http://30daydo.com/article/480。其中利用混入实现多重继承比较重要的就是：</a></p><ol><li>首先它表示一个功能，而不是一个对象或者物品</li><li>必须职责单一，如果有多个功能，就要写多个minin类</li><li>不依赖于子类的实现</li><li>即使子类没有继承该类，也可以正常运行。只不过没有该方法</li></ol><p>比如在联系人当中，我们要给某个人发邮件，发邮件这个功能可以利用混入的方式实现多重继承</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 类变量</span>    all_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">MailSender</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">send_mail</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"send email to {self.email}"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">EmailableContact</span><span class="token punctuation">(</span>Contact<span class="token punctuation">,</span> MailSender<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>e <span class="token operator">=</span> EmailableContact<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"test@example.com"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>all_contacts<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># [&lt;__main__.EmailableContact object at 0x109cdde48>]</span>e<span class="token punctuation">.</span>send_mail<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># send email to test@example.com</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>多重继承在混合不同类的方法时不会有问题，但是当调用父类的方法时就会变得很混乱</p><p>为了讨论更复杂的情况，我们在<code>Friend</code>类中加入家庭住址。应该更好的方法是利用组合的方式，创建一个<code>Address</code>类，在<code>Friend</code>中的地址指向<code>Address</code>类的实例。但是在这里采用继承的方式。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">AddressHolder</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> street<span class="token punctuation">,</span> city<span class="token punctuation">,</span> state<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>street <span class="token operator">=</span> street        self<span class="token punctuation">.</span>city <span class="token operator">=</span> city        self<span class="token punctuation">.</span>state <span class="token operator">=</span> state        self<span class="token punctuation">.</span>code <span class="token operator">=</span> code<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="钻石型继承问题"><a href="#钻石型继承问题" class="headerlink" title="钻石型继承问题"></a>钻石型继承问题</h3><p>首先可以用多重继承的方式为已有的<code>Friend</code>类添加父类，但是现在有了两个父类，需要初始化两个父类。先从一个简单的方法开始</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 类变量</span>    all_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email        Contact<span class="token punctuation">.</span>all_contacts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">AddressHolder</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> street<span class="token punctuation">,</span> city<span class="token punctuation">,</span> state<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>street <span class="token operator">=</span> street        self<span class="token punctuation">.</span>city <span class="token operator">=</span> city        self<span class="token punctuation">.</span>state <span class="token operator">=</span> state        self<span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token keyword">class</span> <span class="token class-name">Friend</span><span class="token punctuation">(</span>Contact<span class="token punctuation">,</span> AddressHolder<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> street<span class="token punctuation">,</span> city<span class="token punctuation">,</span> state<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>        Contact<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">,</span> email<span class="token punctuation">)</span>        AddressHolder<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>street<span class="token punctuation">,</span> city<span class="token punctuation">,</span> state<span class="token punctuation">,</span> code<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的例子是可以正常运行的，但是会有两个问题</p><ol><li>如果忘记了初始化父类，就会出现问题</li><li>可能会导致超类被多次调用</li></ol><p>下面是整个初始化的流程：</p><img src="./钻石继承问题1.png"><p>从图中可以看出分别在初始化<code>Contact</code>和<code>AddressHolder</code>时都初始化了<code>object</code>，既<code>object</code>被初始化了两次。</p><p>为了更加清楚的阐述这个问题，让我们看另外一个虚构的例子。</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BaseClass</span><span class="token punctuation">:</span>    num_base_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Base Class"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_base_call <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">class</span> <span class="token class-name">LeftSubclass</span><span class="token punctuation">(</span>BaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>    num_left_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        BaseClass<span class="token punctuation">.</span>call_me<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Left Subclass"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_left_call <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">class</span> <span class="token class-name">RightSubclass</span><span class="token punctuation">(</span>BaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>    num_right_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        BaseClass<span class="token punctuation">.</span>call_me<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Right Subclass"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_right_call <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">class</span> <span class="token class-name">Subclass</span><span class="token punctuation">(</span>LeftSubclass<span class="token punctuation">,</span> RightSubclass<span class="token punctuation">)</span><span class="token punctuation">:</span>    num_sub_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        LeftSubclass<span class="token punctuation">.</span>call_me<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        RightSubclass<span class="token punctuation">.</span>call_me<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Subclass"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_sub_call <span class="token operator">+=</span> <span class="token number">1</span>s <span class="token operator">=</span> Subclass<span class="token punctuation">(</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>call_me<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Calling method on Base Class</span><span class="token comment" spellcheck="true"># Calling method on Left Subclass</span><span class="token comment" spellcheck="true"># Calling method on Base Class</span><span class="token comment" spellcheck="true"># Calling method on Right Subclass</span><span class="token comment" spellcheck="true"># Calling method on Subclass</span><span class="token keyword">print</span><span class="token punctuation">(</span>f"num_sub_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_sub_call<span class="token punctuation">}</span>\nnum_left_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_left_call<span class="token punctuation">}</span>\n\num_right_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_right_call<span class="token punctuation">}</span>\nnum_base_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_base_call<span class="token punctuation">}</span>\n"<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># num_sub_call: 1</span><span class="token comment" spellcheck="true"># num_left_call: 1</span><span class="token comment" spellcheck="true"># num_right_call: 1</span><span class="token comment" spellcheck="true"># num_base_call: 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面是整个流程图：</p><p><img src="./%E9%92%BB%E7%9F%B3%E7%BB%A7%E6%89%BF%E9%97%AE%E9%A2%982.png" alt="钻石继承问题2"></p><p>整个调用流程看起来像是钻石，因此也叫做钻石继承问题</p><p>从输出可以看到<code>BaseClass</code>的<code>call_me</code>方法被调用了两次。关于多重继承需要记住，我们只想调用类层级中的“下一个”方法，而不是“父类”方法。实际上下一个方法可能不属于该类的父类或者更早的祖先。super关键字再次拯救了我们</p><p>修改后的代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BaseClass</span><span class="token punctuation">:</span>    num_base_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Base Class"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_base_call <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">class</span> <span class="token class-name">LeftSubclass</span><span class="token punctuation">(</span>BaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>    num_left_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call_me<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Left Subclass"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_left_call <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">class</span> <span class="token class-name">RightSubclass</span><span class="token punctuation">(</span>BaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>    num_right_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call_me<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Right Subclass"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_right_call <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">class</span> <span class="token class-name">Subclass</span><span class="token punctuation">(</span>LeftSubclass<span class="token punctuation">,</span> RightSubclass<span class="token punctuation">)</span><span class="token punctuation">:</span>    num_sub_call <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">call_me</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call_me<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calling method on Subclass"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_sub_call <span class="token operator">+=</span> <span class="token number">1</span>s <span class="token operator">=</span> Subclass<span class="token punctuation">(</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>call_me<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Calling method on Base Class</span><span class="token comment" spellcheck="true"># Calling method on Right Subclass</span><span class="token comment" spellcheck="true"># Calling method on Left Subclass</span><span class="token comment" spellcheck="true"># Calling method on Subclass</span><span class="token keyword">print</span><span class="token punctuation">(</span>f"num_sub_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_sub_call<span class="token punctuation">}</span>\nnum_left_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_left_call<span class="token punctuation">}</span>\n\num_right_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_right_call<span class="token punctuation">}</span>\nnum_base_call<span class="token punctuation">:</span> <span class="token punctuation">{</span>s<span class="token punctuation">.</span>num_base_call<span class="token punctuation">}</span>\n"<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># num_sub_call: 1</span><span class="token comment" spellcheck="true"># num_left_call: 1</span><span class="token comment" spellcheck="true"># num_right_call: 1</span><span class="token comment" spellcheck="true"># num_base_call: 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从输出结果可以看到<code>BaseClass</code>的<code>call_me</code>方法只被调用了一次。</p><p>从流程中看到，<code>Subclass</code>的<code>call_me</code>方法调用<code>super().calll_me()</code>，指向了<code>LeftSubclass.call_me()</code>，然后<code>LeftSubclass.call_me()</code>调用了<code>super().call_me()</code>，但是这里<code>super()</code>指向的是<code>RightSubclass.call_me()</code>，而不是他父类<code>BaseClass.call_me()</code>。然后<code>RightSubclass</code>在调用<code>BaseClass</code></p><p>特别注意的就是<code>LeftSubclass</code>中的<code>super()</code>指向的并不是他的父类，这样就实现了调用下一个方法而不是父类的方法。通过使用<code>super</code>可以确保类层级中的每一个方法都被调用一次</p><p>从上面的例子可以看到<code>super</code>的两个作用：</p><ol><li>调用父类方法，通常用来初始化父类</li><li>解决钻石继承问题，防止祖先类方法被调用多次</li></ol><h3 id="不同集合的参数"><a href="#不同集合的参数" class="headerlink" title="不同集合的参数"></a>不同集合的参数</h3><p>之前遇到继承的例子里，父类都是不需要参数初始化的。如果在多重继承下有这样的场景，每个父类都需要不同的参数初始化，那该怎样做呢？可惜的是，解决这个问题的唯一办法就是从头开始计划，我们不得不将基类的参数列表设计成接受任意关键字参数，而且这些参数对于所有子类的实现都是可选的。最后，我们必须确保能够接受不需要的参数并将其传递给自己的<code>super</code>方法，以防他们在后续继承顺序的方法中会用到</p><p>修改后的代码如下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Contact</span><span class="token punctuation">:</span>    all_contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email<span class="token keyword">class</span> <span class="token class-name">AddressHolder</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> street<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> state<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>street <span class="token operator">=</span> street        self<span class="token punctuation">.</span>city <span class="token operator">=</span> city        self<span class="token punctuation">.</span>state <span class="token operator">=</span> state        self<span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token keyword">class</span> <span class="token class-name">Friend</span><span class="token punctuation">(</span>Contact<span class="token punctuation">,</span> AddressHolder<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> phone<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样就能够初始化不同参数的父类了</p><p>但是，如果子类和父类都需要同一个参数呢？比如Friend和Contact都需要phone参数呢？总共有下面几种方法：</p><ol><li>不要将phone作为关键字参数，而是放在<code>**kwargs</code>中，需要改参数的可以通过<code>kwargs[&#39;phone&#39;]</code>获取</li><li>将phone作为关键字参数，在Friend类中再将phone加入到<code>kwargs</code>中，<code>kwargs[&#39;phone&#39;]=value</code></li><li>将phone作为关键字参数，在Friend类中再将phone加入到<code>kwargs</code>中，使用<code>update</code>方法，该方法适用于更新多个字段到<code>kwargs</code>中</li><li>将phone作为关键字参数，在Friend类中<code>super(phone=phone,**kwargs)</code>这种方式传递给父类</li></ol><p>建议：在实际中尽量多用组合的方式，少用多重继承</p><h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><p>多态：由于所用子类不同而产生不同的行为，而不需要明确知道用的是哪个子类。</p><p>在很多情况下，多态是使用继承关系最重要的一个原因之一</p><p>举个例子：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Animal is running...'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Dog is running...'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Cat is running...'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">run_twice</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">:</span>    animal<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>run_twice<span class="token punctuation">(</span>Animal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Animal is running...</span>run_twice<span class="token punctuation">(</span>Dog<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Dog is running...</span>run_twice<span class="token punctuation">(</span>Cat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Cat is running...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>run_twice</code>函数只管调用传递进来的<code>run</code>方法，而不关心具体是Animal的哪个子类，因为所有的子类都会有<code>run</code>方法，最基本的就是Animal的<code>run</code>方法。可以随便为Animal增加子类，但是<code>run_twice</code>不用改动。这就是多态真正的威力：调用方只管调用，不管细节</p><p>在静态语言中，<code>run_twice</code>的参数必须是Animal或者他的子类，但是在python中有鸭子类型，既：一个对象如果“看起来像是鸭子，走路像鸭子”，那么他就是鸭子。所以<code>run_twice</code>可以接受不是Animal子类的类，只要他有<code>run</code>方法即可。例如：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Animal is running...'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Dog is running...'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Cat is running...'</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test is running..."</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">run_twice</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">:</span>    animal<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>run_twice<span class="token punctuation">(</span>Animal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Animal is running...</span>run_twice<span class="token punctuation">(</span>Dog<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Dog is running...</span>run_twice<span class="token punctuation">(</span>Cat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Cat is running...</span>run_twice<span class="token punctuation">(</span>Test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Test is running...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>run_twice(Test())</code>也是可以正常调用的。</p><p>鸭子类型主要的一个作用：不需要提供所需对象的完整接口，而只需满足实际被访问的接口。</p><p>可能在有些场景下，会调用一些官方库的方法，但他对参数是有要求的，比如必须实现某个方法等。利用鸭子类型，我们就可以只实现参数要求的那个方法，而不必实现参数对象所有的方法才去调用这个官方库方法。</p><h3 id="抽象基类"><a href="#抽象基类" class="headerlink" title="抽象基类"></a>抽象基类</h3><p>虽然鸭子类型很有用，但是要想事先知道这个类是否满足全部的需要并不是一件容易的事。因此，Python引入了抽象基类的概念，抽象基类（Abstract base class），或者是ABCs，定义一组必须被类的鸭子实例实现的方法和属性</p><h4 id="使用抽象基类"><a href="#使用抽象基类" class="headerlink" title="使用抽象基类"></a>使用抽象基类</h4><p>先来看一个例子：</p><pre class="line-numbers language-python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">from</span> rich <span class="token keyword">import</span> <span class="token keyword">print</span>In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">from</span> collections <span class="token keyword">import</span> ContainerIn <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span> help<span class="token punctuation">(</span>Container<span class="token punctuation">)</span>In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>Container<span class="token punctuation">.</span>__abstractmethods__<span class="token punctuation">)</span>frozenset<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'__contains__'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Container类只需要实现一个抽象方法<code>__contains__</code>。</p><p><code>List</code>,<code>str</code>和<code>dict</code>都实现了这个方法，用以表明给的值是否存在于这一数据结构中，我们自定义一个类：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> Container<span class="token keyword">class</span> <span class="token class-name">OddContainer</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__contains__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>x<span class="token punctuation">,</span> int<span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token operator">not</span> x <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">class</span> <span class="token class-name">TestContainer</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span>isinstance<span class="token punctuation">(</span>OddContainer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># True</span><span class="token keyword">print</span><span class="token punctuation">(</span>issubclass<span class="token punctuation">(</span>OddContainer<span class="token punctuation">,</span> Container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># True</span><span class="token keyword">print</span><span class="token punctuation">(</span>isinstance<span class="token punctuation">(</span>TestContainer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Flase</span><span class="token keyword">print</span><span class="token punctuation">(</span>issubclass<span class="token punctuation">(</span>TestContainer<span class="token punctuation">,</span> Container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于Container类规定了鸭子类型实例必须要实现<code>__contains__</code>方法，所以OddContainer可以被认为是Container的子类，而TestContainer不可以</p><p>这就是鸭子类型币传统的多态更棒的原因，我们可以不用继承关系（或者更坏的情况）就能创建一个“是一个”的关系。</p><p>有趣的是Container的子类都可以使用in关键字。实际上in只是<code>__contains__</code>的语法糖。</p><h4 id="创建抽象基类"><a href="#创建抽象基类" class="headerlink" title="创建抽象基类"></a>创建抽象基类</h4><p>Container类其实就是一个抽象基类，下面自己创建一个抽象基类</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> abc<span class="token keyword">class</span> <span class="token class-name">MediaLoader</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>abc<span class="token punctuation">.</span>ABCMeta<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># * 子类必须实现该方法 </span>    @abc<span class="token punctuation">.</span>abstractclassmethod    <span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token comment" spellcheck="true"># * 子类必须提供这一属性</span>    @abc<span class="token punctuation">.</span>abstractproperty    <span class="token keyword">def</span> <span class="token function">ext</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token comment" spellcheck="true"># * 该方法可用类直接调用，而不必用到实例</span>    @classmethod    <span class="token keyword">def</span> <span class="token function">__subclasshook__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MediaLoader __subclasshook"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> cls <span class="token keyword">is</span> MediaLoader<span class="token punctuation">:</span>            attrs <span class="token operator">=</span> set<span class="token punctuation">(</span>dir<span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> set<span class="token punctuation">(</span>cls<span class="token punctuation">.</span>__abstractmethods__<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> attrs<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">class</span> <span class="token class-name">Wav</span><span class="token punctuation">(</span>MediaLoader<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">class</span> <span class="token class-name">Ogg</span><span class="token punctuation">(</span>MediaLoader<span class="token punctuation">)</span><span class="token punctuation">:</span>    ext <span class="token operator">=</span> <span class="token string">".ogg"</span>    <span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token keyword">class</span> <span class="token class-name">TestABCs</span><span class="token punctuation">:</span>    ext <span class="token operator">=</span> <span class="token string">".testABCs"</span>    <span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token comment" spellcheck="true"># x = Wav()</span><span class="token comment" spellcheck="true"># Traceback(most recent call last):</span><span class="token comment" spellcheck="true">#   File "test.py", line 26, in &lt; module ></span><span class="token comment" spellcheck="true">#   x = Wav()</span><span class="token comment" spellcheck="true"># TypeError: Can't instantiate abstract class Wav with abstract methods ext, play</span>o <span class="token operator">=</span> Ogg<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>ext<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># .ogg</span><span class="token keyword">print</span><span class="token punctuation">(</span>isinstance<span class="token punctuation">(</span>Ogg<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MediaLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># MediaLoader __subclasshook</span><span class="token comment" spellcheck="true"># True</span><span class="token keyword">print</span><span class="token punctuation">(</span>isinstance<span class="token punctuation">(</span>TestABCs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MediaLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># MediaLoader __subclasshook</span><span class="token comment" spellcheck="true"># True</span><span class="token keyword">print</span><span class="token punctuation">(</span>issubclass<span class="token punctuation">(</span>Ogg<span class="token punctuation">,</span> MediaLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># True</span><span class="token keyword">print</span><span class="token punctuation">(</span>issubclass<span class="token punctuation">(</span>TestABCs<span class="token punctuation">,</span> MediaLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果继承了抽象基类，但是不实现规定的方法和属性，则会报错</p><h3 id="案例学习"><a href="#案例学习" class="headerlink" title="案例学习"></a>案例学习</h3><p>下面将简单实现一个房屋租赁系统</p><p>继承关系：</p><p><img src="./%E7%AC%AC3%E7%AB%A0-%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0.png" alt="第3章-案例学习"></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_valid_input</span><span class="token punctuation">(</span>input_string<span class="token punctuation">,</span> valid_options<span class="token punctuation">)</span><span class="token punctuation">:</span>    input_string <span class="token operator">=</span> f<span class="token string">"{input_string} {', '.join(valid_options)}\n"</span>    response <span class="token operator">=</span> input<span class="token punctuation">(</span>input_string<span class="token punctuation">)</span>    <span class="token keyword">while</span> response <span class="token operator">not</span> <span class="token keyword">in</span> valid_options<span class="token punctuation">:</span>        response <span class="token operator">=</span> input<span class="token punctuation">(</span>input_string<span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token comment" spellcheck="true"># 房屋和公寓的父类，提供一些共有的参数</span><span class="token keyword">class</span> <span class="token class-name">Property</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> square_feet<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> beds<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> baths<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 防止它不是在继承链的最后一层调用</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>square_feet <span class="token operator">=</span> square_feet        self<span class="token punctuation">.</span>num_bedrooms <span class="token operator">=</span> beds        self<span class="token punctuation">.</span>num_baths <span class="token operator">=</span> baths    <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"PROPERTY DETAILS"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"square footage: {self.square_feet}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"bedrooms: {self.num_bedrooms}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"bathrooms: {self.num_bedrooms}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># * 静态方法，可直接通过类调用，也可以通过实例调用</span>    <span class="token comment" spellcheck="true"># * 静态方法与实例无关，所以没有self参数，同样不能使用super关键字</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> dict<span class="token punctuation">(</span>            square_feet<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"Enter the square feet: "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            beds<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"Enter number of bedrooms: "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            baths<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"Enter number of baths: "</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 公寓</span><span class="token keyword">class</span> <span class="token class-name">Apartment</span><span class="token punctuation">(</span>Property<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 洗衣机</span>    valid_laundries <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"coin"</span><span class="token punctuation">,</span> <span class="token string">"ensuite"</span><span class="token punctuation">,</span> <span class="token string">"none"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 阳台</span>    valid_balconies <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">,</span> <span class="token string">"no"</span><span class="token punctuation">,</span> <span class="token string">"solarium"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> balcony<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> laundry<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>balcony <span class="token operator">=</span> balcony        self<span class="token punctuation">.</span>laundry <span class="token operator">=</span> laundry    <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"APARTMENT DETAILS"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"laundry: {self.laundry}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"has balcony: {self.balcony}"</span><span class="token punctuation">)</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        parent_init <span class="token operator">=</span> Property<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>        laundry <span class="token operator">=</span> get_valid_input<span class="token punctuation">(</span>            <span class="token string">"What laundry facilities does the property have? "</span><span class="token punctuation">,</span> Apartment<span class="token punctuation">.</span>valid_laundries<span class="token punctuation">)</span>        balcony <span class="token operator">=</span> get_valid_input<span class="token punctuation">(</span>            <span class="token string">"Does the property have a balcony? "</span><span class="token punctuation">,</span> Apartment<span class="token punctuation">.</span>valid_balconies<span class="token punctuation">)</span>        parent_init<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token string">"laundry"</span><span class="token punctuation">:</span> laundry<span class="token punctuation">,</span>            <span class="token string">"balcony"</span><span class="token punctuation">:</span> balcony        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> parent_init<span class="token comment" spellcheck="true"># 房屋</span><span class="token keyword">class</span> <span class="token class-name">House</span><span class="token punctuation">(</span>Property<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 车库</span>    valid_garage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"attached"</span><span class="token punctuation">,</span> <span class="token string">"detached"</span><span class="token punctuation">,</span> <span class="token string">"none"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 围栏</span>    valid_fenced <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">,</span> <span class="token string">"no"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_stories<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> garage<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> fenced<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>garage <span class="token operator">=</span> garage        self<span class="token punctuation">.</span>fenced <span class="token operator">=</span> fenced        self<span class="token punctuation">.</span>num_stories <span class="token operator">=</span> num_stories    <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"HOUSE DETAILS"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"# of stories: {self.num_stories}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"garage: {self.garage}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"fenced yard: {self.fenced}"</span><span class="token punctuation">)</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        parent_init <span class="token operator">=</span> Property<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>        fenced <span class="token operator">=</span> get_valid_input<span class="token punctuation">(</span>            <span class="token string">"Is the yard fenced? "</span><span class="token punctuation">,</span> House<span class="token punctuation">.</span>valid_fenced<span class="token punctuation">)</span>        garage <span class="token operator">=</span> get_valid_input<span class="token punctuation">(</span>            <span class="token string">"Is there a garage? "</span><span class="token punctuation">,</span> House<span class="token punctuation">.</span>valid_garage<span class="token punctuation">)</span>        num_stories <span class="token operator">=</span> input<span class="token punctuation">(</span><span class="token string">"How many stories? "</span><span class="token punctuation">)</span>        parent_init<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token string">"fenced"</span><span class="token punctuation">:</span> fenced<span class="token punctuation">,</span>            <span class="token string">"garage"</span><span class="token punctuation">:</span> garage<span class="token punctuation">,</span>            <span class="token string">"num_stories"</span><span class="token punctuation">:</span> num_stories        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> parent_init<span class="token comment" spellcheck="true"># 购买</span><span class="token keyword">class</span> <span class="token class-name">Purchase</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> taxes<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>price <span class="token operator">=</span> price        self<span class="token punctuation">.</span>taxes <span class="token operator">=</span> taxes    <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"PURCHASE DETAILS"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"selling price: {self.price}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"estimated taxes: {self.taxes}"</span><span class="token punctuation">)</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> dict<span class="token punctuation">(</span>            price<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"What is the selling price? "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            taxes<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"What are the estimated taxes? "</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 租房</span><span class="token keyword">class</span> <span class="token class-name">Rental</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> furnished<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> utilities<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> rent<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>furnished <span class="token operator">=</span> furnished        self<span class="token punctuation">.</span>utilities <span class="token operator">=</span> utilities        self<span class="token punctuation">.</span>rent <span class="token operator">=</span> rent    <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"RENTAL DETAILS"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"rent: {self.rent}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"estimated utilities: {self.utilities}"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"furnished: {self.furnished}"</span><span class="token punctuation">)</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> dict<span class="token punctuation">(</span>            rent<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"What is the monthly rent? "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            utilities<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"What are the estimated utilities? "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            furnished<span class="token operator">=</span>get_valid_input<span class="token punctuation">(</span>                <span class="token string">"Is the property furnished? "</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">,</span> <span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 租房子</span><span class="token keyword">class</span> <span class="token class-name">HouseRental</span><span class="token punctuation">(</span>Rental<span class="token punctuation">,</span> House<span class="token punctuation">)</span><span class="token punctuation">:</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        init <span class="token operator">=</span> House<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>        init<span class="token punctuation">.</span>update<span class="token punctuation">(</span>Rental<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> initinit <span class="token operator">=</span> HouseRental<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>house <span class="token operator">=</span> HouseRental<span class="token punctuation">(</span><span class="token operator">**</span>init<span class="token punctuation">)</span>house<span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">'''Enter the square feet: 1Enter number of bedrooms: 2Enter number of baths: 3Is the yard fenced?  yes, noyesIs there a garage?  attached, detached, noneattachedHow many stories? 3What is the monthly rent? 12What are the estimated utilities? 100Is the property furnished?  yes, noyesPROPERTY DETAILS==========square footage: 1bedrooms: 2bathrooms: 2HOUSE DETAILS# of stories: 3garage: attachedfenced yard: yesRENTAL DETAILSrent: 12estimated utilities: 100furnished: yes'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>注意：在前面的例子中如果我们将HouseRental继承顺序改为<code>(House, Rental)</code>，将不会触发<code>Rental.display()</code>方法。因为当调用<code>House.display</code>方式时，会调用<code>Property.display</code>方法。但是<code>Property.display()</code>中没有调用<code>super</code>，所以调用不了<code>Rental.display</code>方法。如果在Property中调用<code>super().display()</code>方法则不行，因为<code>object</code>对象没有<code>display</code>方法。可行的方式是Rental也继承Property，就成了之前讲到的钻石继承问题了。<code>super()</code>能轻松的解决。</p></blockquote><p>继续编写剩余代码：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 租公寓</span><span class="token keyword">class</span> <span class="token class-name">ApartmentRental</span><span class="token punctuation">(</span>Rental<span class="token punctuation">,</span> Apartment<span class="token punctuation">)</span><span class="token punctuation">:</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        init <span class="token operator">=</span> Apartment<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>        init<span class="token punctuation">.</span>update<span class="token punctuation">(</span>Rental<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> init<span class="token comment" spellcheck="true"># 买公寓</span><span class="token keyword">class</span> <span class="token class-name">ApartmentPurchase</span><span class="token punctuation">(</span>Purchase<span class="token punctuation">,</span> Apartment<span class="token punctuation">)</span><span class="token punctuation">:</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        init <span class="token operator">=</span> Purchase<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>        init<span class="token punctuation">.</span>update<span class="token punctuation">(</span>Rental<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> init<span class="token comment" spellcheck="true"># 买房子</span><span class="token keyword">class</span> <span class="token class-name">HousePurchase</span><span class="token punctuation">(</span>Purchase<span class="token punctuation">,</span> House<span class="token punctuation">)</span><span class="token punctuation">:</span>    @staticmethod    <span class="token keyword">def</span> <span class="token function">prompt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        init <span class="token operator">=</span> House<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>        init<span class="token punctuation">.</span>update<span class="token punctuation">(</span>Purchase<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> init<span class="token keyword">class</span> <span class="token class-name">Agent</span><span class="token punctuation">:</span>    type_map <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token punctuation">(</span><span class="token string">"house"</span><span class="token punctuation">,</span> <span class="token string">"rental"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HouseRental<span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token string">"house"</span><span class="token punctuation">,</span> <span class="token string">"purchase"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HousePurchase<span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token string">"apartment"</span><span class="token punctuation">,</span> <span class="token string">"rental"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ApartmentRental<span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token string">"apartment"</span><span class="token punctuation">,</span> <span class="token string">"purchase"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ApartmentPurchase    <span class="token punctuation">}</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>property_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">display_properties</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> property <span class="token keyword">in</span> self<span class="token punctuation">.</span>property_list<span class="token punctuation">:</span>            property<span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">add_property</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        property_type <span class="token operator">=</span> get_valid_input<span class="token punctuation">(</span>            <span class="token string">"What type of property? "</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"house"</span><span class="token punctuation">,</span> <span class="token string">"apartment"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>        payment_type <span class="token operator">=</span> get_valid_input<span class="token punctuation">(</span>            <span class="token string">"What payment type? "</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"purchase"</span><span class="token punctuation">,</span> <span class="token string">"rental"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>        PropertyClass <span class="token operator">=</span> self<span class="token punctuation">.</span>type_map<span class="token punctuation">[</span><span class="token punctuation">(</span>property_type<span class="token punctuation">,</span> payment_type<span class="token punctuation">)</span><span class="token punctuation">]</span>        init_args <span class="token operator">=</span> PropertyClass<span class="token punctuation">.</span>prompt_init<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>property_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>PropertyClass<span class="token punctuation">(</span><span class="token operator">**</span>init_args<span class="token punctuation">)</span><span class="token punctuation">)</span>agent <span class="token operator">=</span> Agent<span class="token punctuation">(</span><span class="token punctuation">)</span>agent<span class="token punctuation">.</span>add_property<span class="token punctuation">(</span><span class="token punctuation">)</span>agent<span class="token punctuation">.</span>add_property<span class="token punctuation">(</span><span class="token punctuation">)</span>agent<span class="token punctuation">.</span>display_properties<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># What type of property?  house, apartment</span><span class="token comment" spellcheck="true"># house</span><span class="token comment" spellcheck="true"># What payment type?  purchase, rental</span><span class="token comment" spellcheck="true"># purchase</span><span class="token comment" spellcheck="true"># Enter the square feet: 1</span><span class="token comment" spellcheck="true"># Enter number of bedrooms: 2</span><span class="token comment" spellcheck="true"># Enter number of baths: 3</span><span class="token comment" spellcheck="true"># Is the yard fenced?  yes, no</span><span class="token comment" spellcheck="true"># yes</span><span class="token comment" spellcheck="true"># Is there a garage?  attached, detached, none</span><span class="token comment" spellcheck="true"># none</span><span class="token comment" spellcheck="true"># How many stories? 4</span><span class="token comment" spellcheck="true"># What is the selling price? 12</span><span class="token comment" spellcheck="true"># What are the estimated taxes? 23</span><span class="token comment" spellcheck="true"># What type of property?  house, apartment</span><span class="token comment" spellcheck="true"># house</span><span class="token comment" spellcheck="true"># What payment type?  purchase, rental</span><span class="token comment" spellcheck="true"># rental</span><span class="token comment" spellcheck="true"># Enter the square feet: 2</span><span class="token comment" spellcheck="true"># Enter number of bedrooms: 3</span><span class="token comment" spellcheck="true"># Enter number of baths: 4</span><span class="token comment" spellcheck="true"># Is the yard fenced?  yes, no</span><span class="token comment" spellcheck="true"># no</span><span class="token comment" spellcheck="true"># Is there a garage?  attached, detached, none</span><span class="token comment" spellcheck="true"># none</span><span class="token comment" spellcheck="true"># How many stories? 6</span><span class="token comment" spellcheck="true"># What is the monthly rent? 12</span><span class="token comment" spellcheck="true"># What are the estimated utilities? 4</span><span class="token comment" spellcheck="true"># Is the property furnished?  yes, no</span><span class="token comment" spellcheck="true"># no</span><span class="token comment" spellcheck="true"># PROPERTY DETAILS</span><span class="token comment" spellcheck="true"># == == == == ==</span><span class="token comment" spellcheck="true"># square footage: 1</span><span class="token comment" spellcheck="true"># bedrooms: 2</span><span class="token comment" spellcheck="true"># bathrooms: 2</span><span class="token comment" spellcheck="true"># HOUSE DETAILS</span><span class="token comment" spellcheck="true"># # of stories: 4</span><span class="token comment" spellcheck="true"># garage: none</span><span class="token comment" spellcheck="true"># fenced yard: yes</span><span class="token comment" spellcheck="true"># PURCHASE DETAILS</span><span class="token comment" spellcheck="true"># selling price: 12</span><span class="token comment" spellcheck="true"># estimated taxes: 23</span><span class="token comment" spellcheck="true"># PROPERTY DETAILS</span><span class="token comment" spellcheck="true"># == == == == ==</span><span class="token comment" spellcheck="true"># square footage: 2</span><span class="token comment" spellcheck="true"># bedrooms: 3</span><span class="token comment" spellcheck="true"># bathrooms: 3</span><span class="token comment" spellcheck="true"># HOUSE DETAILS</span><span class="token comment" spellcheck="true"># # of stories: 6</span><span class="token comment" spellcheck="true"># garage: none</span><span class="token comment" spellcheck="true"># fenced yard: no</span><span class="token comment" spellcheck="true"># RENTAL DETAILS</span><span class="token comment" spellcheck="true"># rent: 12</span><span class="token comment" spellcheck="true"># estimated utilities: 4</span><span class="token comment" spellcheck="true"># furnished: no</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python 笔记 面向对象 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RESTful API</title>
      <link href="/2020/06/27/restfule-api/"/>
      <url>/2020/06/27/restfule-api/</url>
      
        <content type="html"><![CDATA[<h2 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>​    最近在项目中单独负责一个组件的开发，这个组件的输出是通过api的方式输出。虽然接口不多，也就15个api左右，但是越往后写就越感觉不太对劲。在和同时联调沟通的时候也发现了很多的问题。一直都想要好好总结下，趁着今天下班早有时间就反思一下吧。</p><p>​    我总结了目前我发现的这个项目的一些问题</p><ol><li>API风格混乱</li><li>API设计不好，不能更加友好的支持API升级</li><li>返回状态码的滥用</li><li>接口返回数据结构不一致</li><li>接口太碎片化</li><li>由于是go语言写的，基本每个接口都用到了defer</li></ol><p>​    站在现在的角度来看，其实这个组件的api是想当失败，可以说是不忍直视。当然有一小部分原因是项目紧急的缘故。但是不可否认的是主要还是因为我的原因才导致了这样的结果。所以我决定新开一个分支，在下班时间重构这个组件的API。虽然这个新重构后的API上线的可能性不大（因为好多项目已经集成了该组件，改动起来花费的资源很大）。但也算是对自己的一个交代吧。</p><p>​    自己算了算之前也参与过三个项目相关业务API的开发。但是都是在别人的基础上进行开发，看到别人没有过多的去关注这些东西。所以自己也就自然而然的没有过多的去思考，就顺着那种思路开发下去了。总之该来的还是会来的。这次的更改可能对这个组件起不了多大的作用。但是希望能够给自己敲响警钟，避免下次出现同样的问题。</p><h3 id="REST-API的一些规范"><a href="#REST-API的一些规范" class="headerlink" title="REST API的一些规范"></a>REST API的一些规范</h3><p>实现REST API标准比较好的例子就是<a href="https://developer.github.com/v3/#current-version" target="_blank" rel="noopener">https://developer.github.com/v3/#current-version</a></p><ol><li><p>在API中指定版本</p><p>一种是可以放在url中，另外一种就是将版本放在HTTP请求头中。还是放在url中比较方便</p></li><li><p>url中不能出现动词，名词也应该使用复数</p><p>因为RESTful面向的都是资源，所以在url中不能包含动词。</p></li><li><p>对资源的操作都是用HTTP动词</p><p>常用到的HTTP动词</p><table><thead><tr><th>动词</th><th>作用</th><th>返回结果</th></tr></thead><tbody><tr><td>GET</td><td>从服务器获取资源</td><td>获取单个资源对象或者资源对象数组</td></tr><tr><td>POST</td><td>新建资源</td><td>新生成的资源对象</td></tr><tr><td>PUT</td><td>更新整个对象，需要客户端提供完整的对象</td><td>更新后的资源对象</td></tr><tr><td>PATCH</td><td>更新对象的某个部分，需要客户端提供更新的部分</td><td>更新后的资源对象</td></tr><tr><td>DELETE</td><td>删除整个对象</td><td>返回一个空文档</td></tr></tbody></table></li></ol><p>一些例子</p><pre><code>```bashGET /zoos：列出所有动物园POST /zoos：新建一个动物园GET /zoos/ID：获取某个指定动物园的信息PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）DELETE /zoos/ID：删除某个动物园GET /zoos/ID/animals：列出某个指定动物园的所有动物DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物```</code></pre><ol start="4"><li><p>过滤信息</p><p>一些例子</p><pre class="line-numbers language-bash"><code class="language-bash">?limit<span class="token operator">=</span>10：指定返回记录的数量?offset<span class="token operator">=</span>10：指定返回记录的开始位置。?page<span class="token operator">=</span>2<span class="token operator">&amp;</span>per_page<span class="token operator">=</span>100：指定第几页，以及每页的记录数。?sortby<span class="token operator">=</span>name<span class="token operator">&amp;</span>order<span class="token operator">=</span>asc：指定返回结果按照哪个属性排序，以及排序顺序。?animal_type_id<span class="token operator">=</span>1：指定筛选条件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中 GET /zoo/ID/animals 与 GET /animals?zoo=ID都是REST的风格。一直都以为只有第一种才是</p></li><li><p>状态码</p><pre class="line-numbers language-bash"><code class="language-bash">200 OK - <span class="token punctuation">[</span>GET<span class="token punctuation">]</span>：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。201 CREATED - <span class="token punctuation">[</span>POST/PUT/PATCH<span class="token punctuation">]</span>：用户新建或修改数据成功。202 Accepted - <span class="token punctuation">[</span>*<span class="token punctuation">]</span>：表示一个请求已经进入后台排队（异步任务）204 NO CONTENT - <span class="token punctuation">[</span>DELETE<span class="token punctuation">]</span>：用户删除数据成功。400 INVALID REQUEST - <span class="token punctuation">[</span>POST/PUT/PATCH<span class="token punctuation">]</span>：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。401 Unauthorized - <span class="token punctuation">[</span>*<span class="token punctuation">]</span>：表示用户没有权限（令牌、用户名、密码错误）。403 Forbidden - <span class="token punctuation">[</span>*<span class="token punctuation">]</span> 表示用户得到授权（与401错误相对），但是访问是被禁止的。404 NOT FOUND - <span class="token punctuation">[</span>*<span class="token punctuation">]</span>：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。406 Not Acceptable - <span class="token punctuation">[</span>GET<span class="token punctuation">]</span>：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。410 Gone -<span class="token punctuation">[</span>GET<span class="token punctuation">]</span>：用户请求的资源被永久删除，且不会再得到的。422 Unprocesable entity - <span class="token punctuation">[</span>POST/PUT/PATCH<span class="token punctuation">]</span> 当创建一个对象时，发生一个验证错误。500 INTERNAL SERVER ERROR - <span class="token punctuation">[</span>*<span class="token punctuation">]</span>：服务器发生错误，用户将无法判断发出的请求是否成功。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>返回结果</p><pre class="line-numbers language-bash"><code class="language-bash">GET /collection：返回资源对象的列表（数组）GET /collection/resource：返回单个资源对象POST /collection：返回新生成的资源对象PUT /collection/resource：返回完整的资源对象PATCH /collection/resource：返回完整的资源对象DELETE /collection/resource：返回一个空文档<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>Hypermedia API</p><p>个人认为这个在公司这种项目中是可以省略的，毕竟公司项目中的API都是面向特定的用户，而且有安全限制，不会把所有的API都暴露出去。</p></li><li><p>API的用户认证使用OAuth 2.0框架</p><p>这个单独拿出来写一写</p></li></ol><p>其实RESTful规范也不多，在实际中除非有特殊情况，都要尽量的遵守规范。</p><p>参考链接：</p><p><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/05/restful_api.html</a></p><p><a href="https://docs.microsoft.com/zh-cn/azure/architecture/best-practices/api-design" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/azure/architecture/best-practices/api-design</a></p>]]></content>
      
      
      <categories>
          
          <category> 工作问题解决 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RESTful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python可变对象和不可变对象</title>
      <link href="/2020/06/27/python-mutable/"/>
      <url>/2020/06/27/python-mutable/</url>
      
        <content type="html"><![CDATA[<p>在Python中所有的一切都是对象，都是继承同一个对象<code>object</code>。</p><blockquote><p><code>object</code>是所有对象的基类，<code>type</code>也是继承<code>object</code></p></blockquote><blockquote><p><code>type</code>是一切type的类型</p></blockquote><p>借用<a href="https://colinoftroy.wordpress.com/2012/12/03/differences-between-python-types-and-objects/" target="_blank" rel="noopener">某博客里的一张图片</a>，他们的关系应该是这样的（蓝色表示继承，红色表示类型）</p><p><img src="./python.jpg" alt="img"></p><h3 id="可变和不可变对象的区别"><a href="#可变和不可变对象的区别" class="headerlink" title="可变和不可变对象的区别"></a>可变和不可变对象的区别</h3><p>Python中的数据结构也可以分为可变对象和不可变对象两类</p><ul><li>可变对象：<code>list</code>,<code>set</code>,<code>dict</code></li><li>不可变对象：<code>tuple</code>,<code>int</code>,<code>float</code>,<code>string</code>,<code>bool</code></li></ul><p><strong>这里说的可变和不可变都是基于内存地址中的数据来区分的</strong>，看个例子</p><pre class="line-numbers language-python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>In <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b <span class="token operator">=</span> aIn <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>In <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">:</span> aOut<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这里a和b都指向了同一个内存地址，因为是<code>list</code>，所以b能够修改内存地址当中的数据，所以打印a时就会输出内存地址当中修改后的数据。</p><p>下面看看不可变对象的例子</p><pre class="line-numbers language-python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>In <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b <span class="token operator">=</span> aIn <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>TypeError       Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token operator">&lt;</span>ipython<span class="token operator">-</span>input<span class="token number">-17</span><span class="token operator">-</span><span class="token number">62bbbc50f611</span><span class="token operator">></span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">1</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span>TypeError<span class="token punctuation">:</span> <span class="token string">'tuple'</span> object does <span class="token operator">not</span> support item assignment<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为<code>tuple</code>是不可变对象，既内存中记录的数据是不可以修改的，所以当我们修改数据时就出现了错误。</p><p>可能会有人疑问，不可变对象也是可以改变内存地址内容的，比如</p><pre class="line-numbers language-python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token string">"test"</span>In <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b <span class="token operator">=</span> aIn <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token string">"hello"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>其实这并不是修改了内存地址中的数据，而是将a重新指向了另外一个内存地址，如果我们在打印输出b，就会发现b还是”test”。</strong></p><p>从内存地址中更容易理解</p><blockquote><p><code>id()</code>方法可以查看内存地址，其实是不是内存地址，而是逻辑地址</p></blockquote><p>可变对象：</p><pre class="line-numbers language-python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>In <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">:</span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span>Out<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">4370511024</span>In <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b <span class="token operator">=</span> aIn <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>In <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">:</span> aOut<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>In <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">:</span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span>Out<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">4370511024</span>In <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">:</span> id<span class="token punctuation">(</span>b<span class="token punctuation">)</span>Out<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">4370511024</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到a和b指向的内存地址并没有发生变化</p><p>不可变对象：</p><pre class="line-numbers language-python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token string">"test"</span>In <span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">:</span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span>Out<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">4343187248</span>In <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b <span class="token operator">=</span> aIn <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b <span class="token operator">=</span> <span class="token string">"hello"</span>In <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">:</span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span>Out<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">4343187248</span>In <span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">:</span> id<span class="token punctuation">(</span>b<span class="token punctuation">)</span>Out<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">4372234608</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到其实是b指向的内存地址变化了，并不是内存地址当中的数据发生变化了</p><h3 id="可变对象和不可变对象的应用"><a href="#可变对象和不可变对象的应用" class="headerlink" title="可变对象和不可变对象的应用"></a>可变对象和不可变对象的应用</h3><p><strong>我们在实际工作中应该避免使用可变对象作为函数参数传入，除非你明确的知道会发生什么。</strong></p><p>这么做的原因是因为在Python当中是传递参数都是引用传递而不是值传递。关于引用传递可以简单的用下面的例子证明：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>args<span class="token punctuation">:</span> int<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> id<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>    args <span class="token operator">+=</span> <span class="token number">10</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> id<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    args <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> id<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>    test<span class="token punctuation">(</span>args<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> id<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果：</p><pre class="line-numbers language-bash"><code class="language-bash">1 45175108321 451751083211 45175111521 4517510832<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到在<code>test</code>函数中，<code>args</code>和在函数外的<code>args</code>的内存地址都是相同的，所以证明了Python中是传递参数是引用传递。但是最后并没有改变函数外<code>args</code>的值，是因为<code>int</code>类型是不可变对象。如果是可变对象就会改变值。</p><h4 id="可变对象作为函数参数的正向作用"><a href="#可变对象作为函数参数的正向作用" class="headerlink" title="可变对象作为函数参数的正向作用"></a>可变对象作为函数参数的正向作用</h4><p>在有些情况下，可变对象作为函数参数还是非常有用的。</p><p>比如要实现一个生产者-消费者模式</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor<span class="token keyword">class</span> <span class="token class-name">Producer</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>queue <span class="token operator">=</span> queue    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>i<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"producet put a message {i}"</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Consumer</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>queue <span class="token operator">=</span> queue    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"consumer get a message {data}"</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>    producer <span class="token operator">=</span> Producer<span class="token punctuation">(</span>queue<span class="token punctuation">)</span>    consumer <span class="token operator">=</span> Consumer<span class="token punctuation">(</span>queue<span class="token punctuation">)</span>    thread <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    thread<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>producer<span class="token punctuation">.</span>run<span class="token punctuation">)</span>    thread<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>consumer<span class="token punctuation">.</span>run<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果：</p><pre class="line-numbers language-bash"><code class="language-bash">producet put a message 0consumer get a message 0producet put a message 1consumer get a message 1producet put a message 2consumer get a message 2producet put a message 3consumer get a message 3producet put a message 4consumer get a message 4producet put a message 5consumer get a message 5producet put a message 6consumer get a message 6producet put a message 7consumer get a message 7producet put a message 8consumer get a message 8producet put a message 9consumer get a message 9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过可变对象，能够方便的在两个函数中进行通信，不必每次改变数据都去通知对方。</p><h4 id="可变对象作为函数参数的负向作用"><a href="#可变对象作为函数参数的负向作用" class="headerlink" title="可变对象作为函数参数的负向作用"></a>可变对象作为函数参数的负向作用</h4><p>看下面的例子：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'world'</span>, <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'world'</span>, <span class="token string">'world'</span>, <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'world'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>会出现这个问题的原因主要有两个</p><ul><li><strong>默认参数的值只会在函数定义的时候赋值一次</strong></li><li><strong>a变量指向了一个可变对象</strong></li></ul><p>当不给test函数传递参数时，a变量就会修改<code>test(a=[])</code>中的[]的内存地址，而且因为<strong>默认参数的值只会在函数定义的时候赋值一次</strong>，所以后面再次不给test函数传递参数时，a变量还是会指向<code>test(a=[])</code>中的[]的内存地址，所以就出现了上面的结果</p><h5 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h5><p>需要将默认值改为不可变对象</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token operator">not</span> a<span class="token punctuation">:</span>        a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是改成这样还是有个问题，就是有时候函数传递进来的是比如说false、空字符串等。会把这些输入当做没有输入</p><p>优化：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> a <span class="token keyword">is</span> None<span class="token punctuation">:</span>        a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果你的目标是检测函数调用时是否传递了默认值，而不是提供默认值那么会有一个更好的方式</p><p>改进：将<code>None</code>替换为一个独一无二的，用户不可能传入的类型，<code>object</code>是个好的选择</p><pre class="line-numbers language-python"><code class="language-python">_no_value <span class="token operator">=</span> object<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token operator">=</span>_no_value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> a <span class="token keyword">is</span> _no_value<span class="token punctuation">:</span>        a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样即使函数的参数是<code>None</code>，也会判断为传递进来了参数</p>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
